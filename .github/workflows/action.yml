---
name: Node.js CI/CD

on:
  push:
    branches:
      - main

jobs:
  # unit-tests:
  #   runs-on: ubuntu-latest

  #   steps:
  #     - uses: estudosdevops/actions/util-setup-node@main
  #       with:
  #         verdaccio_token: ${{ secrets.VERDACCIO_TOKEN }}

  # sonarqube:
  #   runs-on: ubuntu-latest
  #   needs: unit-tests
  #   steps:
  #     - uses: actions/checkout@main
  #       with:
  #         fetch-depth: 0

  #     - name: Run Scan
  #       uses: sonarsource/sonarqube-scan-action@master
  #       # with:
  #       #   args: >
  #       #     -Dsonar.projectKey="$CI_PROJECT_NAME"
  #       env:
  #         SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
  #         SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}

  build-image:
    runs-on: ubuntu-latest
    steps:
    - uses: SocialGouv/actions/autodevops-build-register@v1
      with:
        project: "sample-app"
        imageName: sample-app/api
        token: ${{ secrets.GITHUB_TOKEN }}

        # dockerfile: "/path/to/Dockerfile" # optional
        # dockercontext: "/path/to/content" # optional
        # dockerbuildargs: | # optional
        #   NODE_ENV=production
        # environment: "preprod" # optional
